<!-- main.html (관리자 대쉬보드: 파일 업로드 및 삭제) -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>관리자 파일 대쉬보드</title>
  <!-- Google Fonts: JUA -->
  <link href="https://fonts.googleapis.com/css?family=Jua&display=swap" rel="stylesheet">
  <style>
    /* 페이지 기본 스타일 및 JUA 폰트 적용 */
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Jua', sans-serif;
      background: linear-gradient(135deg, #f0f0f5, #ffffff);
      color: #333;
    }
    
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    h1 {
      margin: 0;
      font-size: 2em;
    }
    
    /* 업로드 폼 컨테이너 */
    .upload-form {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      margin-bottom: 30px;
    }
    .upload-form input[type="file"] {
      display: none; /* 숨겨서 사용자에게 커스텀 버튼 사용 */
    }
    .upload-form input[type="text"] {
      padding: 8px;
      margin: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 200px;
    }
    
    /* CodePen 버튼 스타일 (https://codepen.io/aaroniker/pen/bGVGNrV 참고) */
    .upload-btn {
      position: relative;
      display: inline-block;
      padding: 15px 30px;
      margin: 5px;
      color: #fff;
      text-transform: uppercase;
      text-decoration: none;
      letter-spacing: 2px;
      background: #0a74da;
      border-radius: 5px;
      transition: background 0.3s ease;
      cursor: pointer;
      overflow: hidden;
    }
    .upload-btn:hover {
      background: #095ac2;
    }
    .upload-btn:active {
      background: #074a9e;
    }
    
    /* 대쉬보드 파일 리스트 */
    .file-list {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    .file-item {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      width: 250px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      word-break: break-all;
    }
    .file-item header {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .delete-btn {
      margin-top: 10px;
      padding: 5px 10px;
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    .delete-btn:hover {
      background: #c0392b;
    }
  </style>
</head>
<body>
  <header>
    <h1>관리자 대쉬보드</h1>
  </header>
  
  <!-- 파일 업로드 영역 -->
  <div class="upload-form">
    <!-- 파일 선택 input (숨김) -->
    <input type="file" id="fileInput">
    <!-- 카테고리 입력 -->
    <input type="text" id="categoryInput" placeholder="카테고리">
    <!-- CodePen 스타일의 커스텀 업로드 버튼 -->
    <div class="upload-btn" id="uploadTrigger">파일 업로드</div>
  </div>
  
  <!-- 업로드된 파일 리스트 (패들렛 대쉬보드 형식) -->
  <div class="file-list" id="fileList">
    <!-- 파일 항목들이 JS로 동적 생성됩니다. -->
  </div>
  
  <script>
    // 로컬 스토리지를 위한 키 설정
    const STORAGE_KEY = 'filesData';

    // 초기 파일 데이터 읽기 (없으면 빈 배열)
    let filesData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

    // 로컬 스토리지에 데이터 저장하는 함수
    function saveFilesData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(filesData));
    }

    // 파일 리스트를 새로 렌더링하는 함수
    function renderFileList() {
      const fileList = document.getElementById('fileList');
      fileList.innerHTML = ''; // 초기화

      // 파일 데이터 배열 순회하며 요소 추가
      filesData.forEach(file => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        
        // 파일 정보 표시 (파일명, 크기, 카테고리, 업로드 날짜)
        let date = new Date(file.timestamp).toLocaleString();
        fileItem.innerHTML = `
          <header>${file.name}</header>
          <div>용량: ${(file.size/1024).toFixed(2)} KB</div>
          <div>카테고리: ${file.category}</div>
          <div>업로드: ${date}</div>
          <a href="${file.url}" download="${file.name}" style="display:inline-block; margin-top:5px; color:#0a74da;">다운로드</a>
        `;
        
        // 삭제 버튼 (관리자에게만 보임)
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = '삭제';
        deleteBtn.onclick = () => deleteFile(file.id);
        fileItem.appendChild(deleteBtn);
        
        fileList.appendChild(fileItem);
      });
    }

    // 파일 삭제 함수
    function deleteFile(id) {
      // 해당 파일 정보를 찾은 후 Blob URL 폐기
      const index = filesData.findIndex(f => f.id === id);
      if (index !== -1) {
        URL.revokeObjectURL(filesData[index].url);
        filesData.splice(index, 1);
        saveFilesData();
        renderFileList();
      }
    }

    // 업로드 트리거 버튼 클릭시 file input 클릭 연결
    document.getElementById('uploadTrigger').addEventListener('click', () => {
      document.getElementById('fileInput').click();
    });

    // 파일 선택 시 처리
    document.getElementById('fileInput').addEventListener('change', (event) => {
      const file = event.target.files[0];
      const category = document.getElementById('categoryInput').value.trim() || '미분류';
      if (file) {
        // 큰 파일로 인한 메모리 이슈 해결을 위해 Blob URL 사용 (FileReader 미사용)
        const blobUrl = URL.createObjectURL(file);
        // 파일 객체 생성 (고유 id는 타임스탬프 사용)
        const fileObj = {
          id: Date.now(),
          name: file.name,
          size: file.size,
          category: category,
          url: blobUrl,
          timestamp: Date.now()
        };
        filesData.push(fileObj);
        saveFilesData();
        renderFileList();
        // 파일 입력 및 카테고리 필드 초기화
        event.target.value = "";
        document.getElementById('categoryInput').value = "";
      }
    });

    // 스토리지 변경 이벤트 (다른 탭 혹은 페이지 동기화를 위한)
    window.addEventListener('storage', (e) => {
      if (e.key === STORAGE_KEY) {
        filesData = JSON.parse(e.newValue) || [];
        renderFileList();
      }
    });

    // 초기 렌더링 수행
    renderFileList();
  </script>
</body>
</html>


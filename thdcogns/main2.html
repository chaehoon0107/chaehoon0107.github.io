<!-- main2.html (사용자 뷰 페이지) -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>사용자 파일 공유 페이지</title>
  <!-- Google Fonts: JUA 체 적용 -->
  <link href="https://fonts.googleapis.com/css2?family=JUA&display=swap" rel="stylesheet">
  <style>
    /* 전역 스타일 */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'JUA', sans-serif;
      background-color: #f4f6f8;
      color: #333;
      padding: 20px;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    h1 { margin: 0; font-size: 2em; }
    .stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
      font-size: 1.1em;
    }
    /* 파일 리스트 영역 */
    .file-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    .file-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      width: 250px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .file-card h3 {
      margin: 0 0 10px 0;
      font-size: 1.2em;
      text-align: center;
    }
    .file-card p {
      margin: 5px 0;
      font-size: 0.9em;
    }
    .download-btn {
      margin-top: 10px;
      padding: 10px 20px;
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.3s;
    }
    .download-btn:hover {
      background: #2980b9;
    }
    /* 반응형 디자인 */
    @media (max-width: 600px) {
      .file-card {
        width: 90%;
      }
      .stats {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>공유된 파일들</h1>
    <!-- 서버 스텟: 전체 파일 수, 전체 용량 -->
    <div class="stats" id="serverStats">
      <!-- 스크립트로 동적으로 채워짐 -->
    </div>
  </header>
  <section class="file-container" id="userFileContainer">
    <!-- 파일 카드들이 여기 추가됨 -->
  </section>

  <script>
    const STORAGE_KEY = 'fileData';

    // 로컬 스토리지에서 파일 데이터 불러오기
    function loadFiles() {
      const files = localStorage.getItem(STORAGE_KEY);
      return files ? JSON.parse(files) : [];
    }

    // 서버 스텟 업데이트: 전체 파일 수와 총 용량 계산
    function updateServerStats() {
      const files = loadFiles();
      const totalFiles = files.length;
      const totalSizeBytes = files.reduce((sum, file) => sum + file.size, 0);
      // 용량을 MB 단위로 표시 (소수점 한자리)
      const totalSizeMB = (totalSizeBytes / (1024 * 1024)).toFixed(1);
      document.getElementById('serverStats').innerHTML = `
        <div>전체 파일 수: ${totalFiles}</div>
        <div>총 용량: ${totalSizeMB} MB</div>
      `;
    }

    // 사용자 파일 카드 렌더링 함수
    function renderUserFiles() {
      const fileContainer = document.getElementById('userFileContainer');
      fileContainer.innerHTML = '';
      const files = loadFiles();
      
      // 파일들을 카테고리별로 그룹화 (필요시)
      files.forEach(file => {
        const card = document.createElement('div');
        card.classList.add('file-card');
        
        const title = document.createElement('h3');
        title.textContent = file.name;
        card.appendChild(title);
        
        const category = document.createElement('p');
        category.textContent = '카테고리: ' + file.category;
        card.appendChild(category);
        
        const time = document.createElement('p');
        time.textContent = '업로드 시간: ' + file.time;
        card.appendChild(time);
        
        // 다운로드 버튼: Blob URL을 이용하여 파일 다운로드
        const downloadLink = document.createElement('a');
        downloadLink.href = file.blobUrl;
        downloadLink.download = file.name;
        downloadLink.classList.add('download-btn');
        downloadLink.textContent = '다운로드';
        card.appendChild(downloadLink);
        
        fileContainer.appendChild(card);
      });
    }

    // 페이지 로드시 파일 목록 및 스텟 업데이트
    function updatePage() {
      updateServerStats();
      renderUserFiles();
    }

    updatePage();

    // 로컬 스토리지 이벤트를 사용해서 다른 탭의 변경 사항을 반영
    window.addEventListener('storage', updatePage);
  </script>
</body>
</html>
